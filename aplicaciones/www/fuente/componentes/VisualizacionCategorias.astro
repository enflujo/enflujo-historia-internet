---
import { listaCategorias } from '@/cerebros/general';

const categorias = await listaCategorias();
console.log(categorias);

// Calcular angulos cada petalo
const totalCategorias = categorias.length;
const angleStep = (2 * Math.PI) / totalCategorias;

const colors = [
  '#b30000', // light blue
  '#4421af', // medium blue
  '#1a53ff', // darker blue
  '#7c1158', // teal
  '#0d88e6',
  '#fd7f6f', // green
  '#00b7c7', // darker green
  '#bd7ebe', // yellow
  '#f39c12', // orange
  '#e67e22', // darker orange
  '#d35400', // burnt orange
  '#e74c3c', // red
  '#c0392b', // darker red
  '#9b59b6', // purple
  '', // darker purple
];
---

<div class="visualizacion-categorias">
  <div class="flor">
    {
      categorias.map((categoria, index) => {
        const angle = index * angleStep;
        const rotationDeg = (angle * 180) / Math.PI;
        const maxCount = Math.max(...categorias.map((c) => c.count));
        const petalLength = Math.max(50, (categoria.count / maxCount) * 150);

        const colorIndex = index % colors.length;
        const petalColor = colors[colorIndex];

        return (
          <div class="petalo-contenedor" style={`transform: rotate(${rotationDeg}deg);`}>
            <div
              class="petalo"
              style={`height: ${petalLength}px; background-color: ${petalColor};`}
              data-count={categoria.count}
              data-color={petalColor}
            >
              <span class="valor" style={`color: ${petalColor};`}>
                {categoria.count}
              </span>
            </div>
            <div class="etiqueta" style={`transform: rotate(${90}deg); top: ${petalLength + 10}px;`}>
              {categoria.name}
            </div>
          </div>
        );
      })
    }
    <div class="centro"></div>
  </div>
</div>

<style>
  .visualizacion-categorias {
    width: 100%;
    height: 100%;
    padding: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .flor {
    position: relative;
    width: 400px;
    height: 400px;
    margin: 20px;
  }

  .petalo-contenedor {
    position: absolute;
    bottom: 50%;
    left: 50%;
    width: 30px;
    height: 200px;
    transform-origin: bottom center;
  }

  .petalo {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 10px; /* Width of each petal */
    /* border-radius: 20% 20% 0 0; */
    transform-origin: bottom center;
    bottom: 10%;
    transition:
      background-color 0.3s ease,
      height 0.5s ease;
  }

  .petalo:hover {
    background-color: var(--cobalto);
  }

  .valor {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 15px;
    font-weight: bold;
    color: var(--cobalto);
  }

  .etiqueta {
    position: absolute;
    width: 100px;
    text-align: start;
    font-size: 10px;
    left: 50%;
    transform-origin: center left;
    transform: translateX(-50%);
    color: #000;
    white-space: nowrap;
  }

  /* .centro {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background-color: var(--cobalto);
    border-radius: 50%;
    z-index: 10;
  } */

  /* Make it responsive */
  @media (max-width: 768px) {
    .flor {
      width: 300px;
      height: 300px;
    }

    .petalo {
      width: 20px;
    }

    .etiqueta {
      font-size: 8px;
    }
  }

  @media (max-width: 480px) {
    .flor {
      width: 250px;
      height: 250px;
    }

    .petalo {
      width: 15px;
    }

    .valor {
      font-size: 8px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Add interactive elements if needed
    const petalos = document.querySelectorAll('.petalo');

    petalos.forEach((petalo) => {
      petalo.addEventListener('mouseover', () => {
        const count = petalo.getAttribute('data-count');
        const color = petalo.getAttribute('data-color');
        // Show tooltip or additional info
      });
    });
  });
</script>
