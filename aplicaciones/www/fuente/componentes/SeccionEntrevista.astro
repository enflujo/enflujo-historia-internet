---
import { listaCategoriasPrincipales } from '@/cerebros/general';
import type { SeccionEntrevistaProcesada } from '@/tipos';
import { base } from '@/utilidades/constantes';

interface props {
  seccion: SeccionEntrevistaProcesada;
}

const { seccion } = Astro.props as props;
const categoriasPrincipales = await listaCategoriasPrincipales();
---

<section class={`seccion ${seccion.categorias.map((cat) => cat.slug).join(' ')}`}>
  <div
    class="colEntrevista"
    style={`background: linear-gradient(135deg, ${seccion.categorias
      .map(
        (cat, i) =>
          `color-mix(in srgb, var(--categoria${categoriasPrincipales.findIndex((c) => c.slug === cat.slug) + 1}), white 60%) ${Math.round((i / (seccion.categorias.length - 1 || 1)) * 100)}%`
      )
      .join(', ')});`}
  >
    <div set:html={seccion.contenido} />
    {
      seccion.audios.map((audio) => (
        <audio controls>
          <source src={audio.url} type={audio.tipo} />
        </audio>
      ))
    }
  </div>

  <div class="separadorCol">
    {
      seccion.categorias.length > 0
        ? seccion.categorias.map((categoria) => (
            <span
              class={`fondoCategoria fondoCategoria${categoriasPrincipales.findIndex((cat) => cat.slug === categoria.slug) + 1}`}
            />
          ))
        : null
    }
  </div>

  <div class="colMetadatos">
    {
      seccion.categorias.length > 0 ? (
        <>
          <div class="categorias">
            {seccion.categorias.map((categoria) => (
              <span class="categoria">
                <a
                  class={`iconoCategoria iconoCategoria${categoriasPrincipales.findIndex((cat) => cat.slug === categoria.slug) + 1}`}
                  href={`${base}/categorias/${categoria.slug}`}
                >
                  {categoria.nombre}
                </a>
                {categoria.hijos.length > 0 && (
                  <div class="hijos">
                    {categoria.hijos.map((hijo) => (
                      <span class="hijo">
                        <a href={`${base}/categorias/${hijo.slug}`}>{hijo.nombre}</a>
                      </span>
                    ))}
                  </div>
                )}
              </span>
            ))}
          </div>
        </>
      ) : null
    }
  </div>
</section>

<style lang="scss">
  .seccion {
    display: flex;
    flex-direction: row;
    gap: 20px;
    margin-bottom: 20px;
  }

  .colEntrevista {
    width: 70%;
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding-right: 1em;
  }

  .separadorCol {
    display: flex;
    flex-direction: row;

    span {
      width: 5px;
      height: 100%;
      &.categoria1 {
        background-color: var(--categoria1);
      }
    }
  }

  .colMetadatos {
    width: 30%;
    display: flex;
    flex-direction: column;

    h4 {
      margin: 0 0 1em 0;
    }
  }

  .categoria {
    font-weight: bold;
  }

  .hijo {
    font-weight: normal;
    margin-left: 10px;
  }

  .categoria,
  .hijo {
    display: block;
    margin-bottom: 5px;
  }
</style>
